(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,a=window.wp.i18n,n=window.wp.htmlEntities,r=window.wp.data,o=window.wc.wcSettings,c=window.wc.wcBlocksRegistry,s=window.React,i=window.jQuery;var p=e.n(i);const l=(0,o.getSetting)("apple_pay_data",{}),u=((0,o.getSetting)("payplug_data",{}),(0,o.getSetting)("apple_pay_data",{})),d=(0,a.__)("Gateway method title","payplug"),y=(0,n.decodeEntities)(u?.title)||d,_=e=>{const{eventRegistration:a,emitResponse:n}=e,{onPaymentSetup:o,onCheckoutSuccess:c,onCheckoutFail:i}=a,{PAYMENT_STORE_KEY:d,CHECKOUT_STORE_KEY:y}=window.wc.wcBlocksData,_=(0,r.useSelect)((e=>e(y).getOrderId()));let m=null;(0,s.useEffect)((()=>{const e=o((async()=>(w.CreateSession(),w.CancelOrder(),await((e,t)=>{const a={order_id:t,"woocommerce-process-checkout-nonce":l.wp_nonce,gateway:"apple_pay"};return new Promise(((e,t)=>p().ajax({type:"POST",data:a,url:l.payplug_create_intent_payment}).success((function(t){e(t)})).error((function(e){t(e)}))))})(0,_).then((async e=>{w.BeginSession(e)})),{type:"success"})));return()=>{e()}}),[o,n.noticeContexts.PAYMENTS,n.responseTypes.ERROR,n.responseTypes.SUCCESS]),(0,s.useEffect)((()=>{const e=c((async({processingResponse:{paymentDetails:e}})=>{var t;await new Promise(((e,n)=>{m.onpaymentauthorized=async r=>{let o={action:"applepay_update_payment",post_type:"POST",payment_id:m.payment_id,payment_token:r.payment.token,order_id:m.order_id};a&&n(),await(e=>new Promise(((t,a)=>{p().ajax({type:"POST",data:e,url:l.ajax_url_applepay_update_payment}).success((function(e){t(e)})).error((function(e,t,n){a(n)}))})))(o).then((a=>{t=ApplePaySession.STATUS_SUCCESS,!0!==a.success&&(t=ApplePaySession.STATUS_FAILURE),m.completePayment({status:t}),e()}))}}));var a=!1;return{type:"success",redirectUrl:m.return_url}}));return()=>{e()}}),[c]);let w={CreateSession:function(){const t={countryCode:u.payplug_countryCode,currencyCode:u.payplug_currencyCode,merchantCapabilities:["supports3DS"],supportedNetworks:["visa","masterCard"],total:{label:"Apple Pay",type:"final",amount:e.billing.cartTotal.value/100},applicationData:btoa(JSON.stringify({apple_pay_domain:u.payplug_apple_pay_domain}))};m=new ApplePaySession(3,t)},CancelOrder:function(){m.oncancel=e=>{window.location=m.cancel_url}},BeginSession:function(e){m.payment_id=e.data.payment_id,m.order_id=_,m.cancel_url=e.data.cancel,m.return_url=e.data.redirect,w.MerchantValidated(m,e.data.merchant_session),m.begin()},MerchantValidated:function(e,t){e.onvalidatemerchant=async a=>{try{e.completeMerchantValidation(t)}catch(e){alert(e)}}}};return(0,t.createElement)(t.Fragment,null)},m=()=>(0,t.createElement)("img",{src:u?.icon.src,alt:u?.icon.icon_alt,className:"payplug-payment-icon",style:{float:"right"}}),w={name:"apple_pay",label:(0,t.createElement)((()=>(0,t.createElement)("span",{style:{width:"100%"}},y,(0,t.createElement)(m,null))),null),content:(0,t.createElement)(_,null),edit:(0,t.createElement)(_,null),canMakePayment:()=>!0,ariaLabel:y,supports:{features:u.supports}};(0,c.registerPaymentMethod)(w)})();