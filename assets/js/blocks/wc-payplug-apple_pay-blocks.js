(()=>{"use strict";var e={20:(e,t,a)=>{var n=a(609),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,a){var n,o={},c=null,l=null;for(n in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)p.call(t,n)&&!i.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:l,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},848:(e,t,a)=>{e.exports=a(20)},609:e=>{e.exports=window.React}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const n=window.wp.i18n,r=window.wp.htmlEntities,o=window.wp.data,p=window.wc.wcSettings,s=window.wc.wcBlocksRegistry;var i=a(609);const c=window.jQuery;var l=a.n(c);const d=(0,p.getSetting)("apple_pay_data",{});var u=a(848);const y=(0,p.getSetting)("apple_pay_data",{}),_=e=>{let t=null,a=null;const n=jQuery("#apple-pay-button-wrapper"),r={load_order_total:!1,OrderPaymentCreated:function(e){"success"!==e.payment_data.result&&r.CancelOrder(),r.BeginSession(e)},CreateSession:function(){const e={countryCode:y.countryCode,currencyCode:y.currencyCode,merchantCapabilities:["supports3DS"],supportedNetworks:["visa","masterCard"],total:{label:"Apple Pay",type:"final",amount:y.total_amount/100},applicationData:btoa(JSON.stringify({apple_pay_domain:y.apple_pay_domain})),requiredBillingContactFields:["postalAddress","name"],requiredShippingContactFields:["postalAddress","name","phone","email"]};y.payplug_apple_pay_shipping_required&&(e.shippingMethods=y.payplug_carriers),t=new ApplePaySession(3,e)},CancelOrder:function(){t.oncancel=e=>{var a;(a={order_id:t.order_id,payment_id:t.payment_id},new Promise(((e,t)=>{l().ajax({type:"POST",data:a,url:d.ajax_url_applepay_cancel_order}).success((function(t){e(t)})).error((function(e,a,n){t(n)}))}))).then((()=>{o()}))}},BeginSession:function(e){t.payment_id=e.payment_data.payment_id,t.order_id=e.order_id,t.cancel_url=e.payment_data.cancel_url,t.return_url=e.payment_data.return_url,r.MerchantValidated(t,e.payment_data.merchant_session),t.amount=100*parseFloat(y.total/100),t.onshippingmethodselected=e=>{const a=e.shippingMethod;t.shippingMethod=a.identifier;const n=y.total/100;let r=a.amount;const o=parseFloat(n)+parseFloat(r);t.amount=100*o;const p={newTotal:{label:"Total",amount:o},newLineItems:[{label:a.label,type:"final",amount:r}]};t.completeShippingMethodSelection(p)},t.begin()},MerchantValidated:function(e,t){e.onvalidatemerchant=a=>{try{e.completeMerchantValidation(t)}catch(e){r.CancelOrder()}}},AddErrorMessage:function(e){n.append(jQuery('<div class="apple-pay-cart-notice"></div>').append("<span>"+e+"</span>"))},DeleteErrorMessage:function(){setTimeout((function(){jQuery(".apple-pay-cart-notice").contents().first().remove()}),4e3)}};function o(){jQuery("apple-pay-button").removeClass("isDisabled")}return jQuery((function(e){jQuery("apple-pay-button").on("click",(e=>{e.preventDefault(),e.stopImmediatePropagation(),jQuery("apple-pay-button").addClass("isDisabled"),r.CreateSession(),r.CancelOrder(),new Promise(((e,t)=>{l().ajax({type:"POST",data:undefined,url:d.ajax_url_place_order_with_dummy_data}).success((function(t){e(t)})).error((function(e,a,n){t(n)}))})).then((async e=>{if(!1===e.success)return r.AddErrorMessage(e.data.message),r.DeleteErrorMessage(),void o();y.total=e.total,r.OrderPaymentCreated(e),await new Promise(((e,n)=>{t.onpaymentauthorized=n=>{let o=n.payment,p={order_id:t.order_id,shipping:o.shippingContact,billing:o.billingContact,shipping_method:t.shippingMethod};(e=>new Promise(((t,a)=>{l().ajax({type:"POST",data:e,url:d.ajax_url_update_applepay_order}).success((function(e){t(e)})).error((function(e,t,n){a(n)}))})))(p).then((o=>{p={action:"applepay_update_payment",post_type:"POST",payment_id:t.payment_id,payment_token:n.payment.token,order_id:t.order_id,amount:t.amount},(e=>new Promise(((t,a)=>{l().ajax({type:"POST",data:e,url:d.ajax_url_update_applepay_payment}).success((function(e){t(e)})).error((function(e,t,n){a(n)}))})))(p).then((n=>{a=ApplePaySession.STATUS_SUCCESS,!0!==n.success&&(a=ApplePaySession.STATUS_FAILURE,r.AddErrorMessage(n.data.message),r.DeleteErrorMessage(),r.CancelOrder()),t.completePayment({status:a}),e()}))}))}})).then((e=>{window.location=t.return_url}))}))}))})),(0,u.jsx)(u.Fragment,{children:" "})},m=(0,p.getSetting)("apple_pay_data",{}),f=(0,n.__)("Gateway method title","payplug"),h=(0,r.decodeEntities)(m?.title)||f,g=e=>{const{eventRegistration:t,emitResponse:a}=e,{onPaymentSetup:n,onCheckoutSuccess:r}=t,{CHECKOUT_STORE_KEY:p}=window.wc.wcBlocksData,s=(0,o.useSelect)((e=>e(p).getOrderId()));let c=null;(0,i.useEffect)((()=>{jQuery((function(e){e("form .wp-block-woocommerce-checkout-actions-block .wc-block-components-button").on("click",(async e=>{e.preventDefault(),y.CreateSession(),y.CancelOrder()}))}))}),[]),(0,i.useEffect)((()=>{const e=n((async()=>{await((e,t)=>{const a={order_id:t,"woocommerce-process-checkout-nonce":d.wp_nonce,gateway:"apple_pay"};return new Promise(((e,t)=>l().ajax({type:"POST",data:a,url:d.payplug_create_intent_payment}).success((function(t){e(t)})).error((function(e){t(e)}))))})(0,s).then((async e=>{await y.BeginSession(e)})).then((async e=>({type:"success"})))}));return()=>{e()}}),[n,a.noticeContexts.PAYMENTS,a.responseTypes.ERROR,a.responseTypes.SUCCESS]),(0,i.useEffect)((()=>{const e=r((async({processingResponse:{paymentDetails:e}})=>{var t;let a={};return await new Promise(((e,a)=>{c.onpaymentauthorized=async a=>{let n={action:"applepay_update_payment",post_type:"POST",payment_id:c.payment_id,payment_token:a.payment.token,order_id:c.order_id};await(e=>new Promise(((t,a)=>{l().ajax({type:"POST",data:e,url:d.ajax_url_applepay_update_payment}).success((function(e){t(e)})).error((function(e,t,n){a(n)}))})))(n).then((a=>{t=ApplePaySession.STATUS_SUCCESS,!0!==a.success&&(t=ApplePaySession.STATUS_FAILURE),c.completePayment({status:t}),e()}))}})).then((()=>{a={type:"success",redirectUrl:c.return_url}})),a}));return()=>{e()}}),[r]);let y={CreateSession:function(){const t={countryCode:m.payplug_countryCode,currencyCode:m.payplug_currencyCode,merchantCapabilities:["supports3DS"],supportedNetworks:["visa","masterCard"],total:{label:"Apple Pay",type:"final",amount:e.billing.cartTotal.value/100},applicationData:btoa(JSON.stringify({apple_pay_domain:m.payplug_apple_pay_domain}))};c=new ApplePaySession(3,t)},CancelOrder:function(){c.oncancel=e=>{window.location=c.cancel_url}},BeginSession:function(e){c.payment_id=e.data.payment_id,c.order_id=s,c.cancel_url=e.data.cancel,c.return_url=e.data.redirect,y.MerchantValidated(c,e.data.merchant_session),c.begin()},MerchantValidated:function(e,t){e.onvalidatemerchant=async a=>{try{e.completeMerchantValidation(t)}catch(e){alert(e)}}}};return(0,u.jsx)(u.Fragment,{})},w=()=>(0,u.jsxs)("span",{style:{width:"100%"},children:[h,(0,u.jsx)(S,{})]}),S=()=>(0,u.jsx)("img",{src:m?.icon.src,alt:m?.icon.icon_alt,className:"payplug-payment-icon",style:{float:"right"}}),C={name:"apple_pay",label:(0,u.jsx)(w,{}),content:(0,u.jsx)(g,{}),edit:(0,u.jsx)(g,{}),canMakePayment:()=>!0,ariaLabel:h,supports:{features:m.supports}},P=e=>(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{id:"apple-pay-button-wrapper",children:(0,u.jsx)("apple-pay-button",{buttonstyle:"black",type:"pay",locale:m?.payplug_locale})}),(0,u.jsx)(_,{...e})]}),j={name:"apple_pay",content:(0,u.jsx)(P,{}),edit:(0,u.jsx)(P,{}),canMakePayment:e=>{if(!m?.is_cart)return!1;if(m.payplug_apple_pay_shipping_required=e.cartNeedsShipping,m.total_amount=e.cartTotals.total_price,!e.cartNeedsShipping)return!0;let t=e.selectedShippingMethods[0].split(":");m.payplug_carriers.forEach((function(e){e.identifier===t&&(e.selected=!0)}));let a=m?.payplug_authorized_carriers,n=e.selectedShippingMethods[0].split(":"),r=!1;return a.forEach((function(e){n[0]===e&&(r=!0)})),r},paymentMethodId:"apple_pay"};(0,s.registerExpressPaymentMethod)(j),(0,s.registerPaymentMethod)(C)})();